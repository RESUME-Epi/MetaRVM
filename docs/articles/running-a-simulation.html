<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running a Simulation with metaRVM • MetaRVM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running a Simulation with metaRVM">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MetaRVM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html" aria-label="MetaRVM"><span class="fa fa-home"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/yaml-configuration.html">Model Configurations</a></li>
    <li><a class="dropdown-item" href="../articles/running-a-simulation.html">Running Simulation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RESUME-Epi/MetaRVM" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Running a Simulation with metaRVM</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RESUME-Epi/MetaRVM/blob/HEAD/vignettes/running-a-simulation.Rmd" class="external-link"><code>vignettes/running-a-simulation.Rmd</code></a></small>
      <div class="d-none name"><code>running-a-simulation.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This vignette demonstrates how to run a <code>metaRVM</code>
simulation using the example configuration and data files included with
the package. This is a good way to get started and understand the basic
workflow.</p>
</div>
<div class="section level3">
<h3 id="locating-the-example-files">Locating the Example Files<a class="anchor" aria-label="anchor" href="#locating-the-example-files"></a>
</h3>
<p>The <code>metaRVM</code> package includes a set of example files in
its <code>extdata</code> directory. To run the example, we first need to
locate these files. The <code><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file()</a></code> function in R is the
recommended way to do this, as it will find the files wherever the
package is installed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Locate the example YAML configuration file</span></span>
<span><span class="va">yaml_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_config.yaml"</span>, package <span class="op">=</span> <span class="st">"MetaRVM"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">yaml_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpEkEVxi/temp_libpath24fd7163cb6ff9/MetaRVM/extdata/example_config.yaml"</span></span></code></pre></div>
<p>The <code>yaml_file</code> variable now holds the full path to the
example configuration file. This file is set up to use the other example
data files (also in the <code>extdata</code> directory) with relative
paths. Below is the content of the yaml file.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">run_id</span><span class="kw">:</span><span class="at"> ExampleRun</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">population_data</span><span class="kw">:</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="at">  </span><span class="fu">mapping</span><span class="kw">:</span><span class="at"> demographic_mapping_n24.csv</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="at">  </span><span class="fu">initialization</span><span class="kw">:</span><span class="at"> population_init_n24.csv</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="at">  </span><span class="fu">vaccination</span><span class="kw">:</span><span class="at"> vaccination_n24.csv</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="fu">mixing_matrix</span><span class="kw">:</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="at">  </span><span class="fu">weekday_day</span><span class="kw">:</span><span class="at"> m_weekday_day.csv</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="at">  </span><span class="fu">weekday_night</span><span class="kw">:</span><span class="at"> m_weekday_night.csv</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="at">  </span><span class="fu">weekend_day</span><span class="kw">:</span><span class="at"> m_weekend_day.csv</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="at">  </span><span class="fu">weekend_night</span><span class="kw">:</span><span class="at"> m_weekend_night.csv</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="fu">disease_params</span><span class="kw">:</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="at">  </span><span class="fu">ts</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="at">  </span><span class="fu">tv</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.25</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="at">  </span><span class="fu">ve</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.4</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="at">  </span><span class="fu">dv</span><span class="kw">:</span><span class="at"> </span><span class="dv">180</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="at">  </span><span class="fu">dp</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="at">  </span><span class="fu">de</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="at">  </span><span class="fu">da</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="at">  </span><span class="fu">ds</span><span class="kw">:</span><span class="at"> </span><span class="dv">6</span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="at">  </span><span class="fu">dh</span><span class="kw">:</span><span class="at"> </span><span class="dv">8</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="at">  </span><span class="fu">dr</span><span class="kw">:</span><span class="at"> </span><span class="dv">180</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="at">  </span><span class="fu">pea</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="at">  </span><span class="fu">psr</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.95</span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="at">  </span><span class="fu">phr</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.97</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="fu">simulation_config</span><span class="kw">:</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="at">  </span><span class="fu">start_date</span><span class="kw">:</span><span class="at"> 01/01/2023</span><span class="co"> # m/d/Y</span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="at">  </span><span class="fu">length</span><span class="kw">:</span><span class="at"> </span><span class="dv">150</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="at">  </span><span class="fu">nsim</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-the-simulation">Running the Simulation<a class="anchor" aria-label="anchor" href="#running-the-simulation"></a>
</h2>
<p>Once we have the path to the configuration file, the simulation can
be run using the <code><a href="../reference/metaRVM.html">metaRVM()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the metaRVM library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://RESUME-Epi.github.io/MetaRVM/">MetaRVM</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the simulation</span></span>
<span><span class="va">sim_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metaRVM.html">metaRVM</a></span><span class="op">(</span><span class="va">yaml_file</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: pkgbuild</span></span>
<span><span class="co">#&gt; Generating model in c</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Re-compiling <span style="color: #0000BB;">odin62a63f38</span> (debug build)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Loading <span style="color: #0000BB;">odin62a63f38</span></span></span></code></pre></div>
<p>The <code><a href="../reference/metaRVM.html">metaRVM()</a></code> function will parse the YAML file, read
the associated data files, run the simulation, and return a
<code>MetaRVMResults</code> object.</p>
<div class="section level3">
<h3 id="deep-dive-into-metarvm-classes">Deep-dive into <code>MetaRVM</code> Classes<a class="anchor" aria-label="anchor" href="#deep-dive-into-metarvm-classes"></a>
</h3>
<div class="section level4">
<h4 id="working-with-configuration-files">Working with Configuration Files<a class="anchor" aria-label="anchor" href="#working-with-configuration-files"></a>
</h4>
<p>The simulation can be run by directly providing a YAML configuration
file path, or by creating a <code>MetaRVMConfig</code> object.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load configuration from YAML file</span></span>
<span><span class="va">config_obj</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/MetaRVMConfig.html">MetaRVMConfig</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">yaml_file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Examine the configuration</span></span>
<span><span class="va">config_obj</span></span>
<span><span class="co">#&gt; MetaRVM Configuration Object</span></span>
<span><span class="co">#&gt; ============================</span></span>
<span><span class="co">#&gt; Config file: /tmp/RtmpEkEVxi/temp_libpath24fd7163cb6ff9/MetaRVM/extdata/example_config.yaml </span></span>
<span><span class="co">#&gt; Parameters: 40 </span></span>
<span><span class="co">#&gt; Parameter names (first 10): N_pop, pop_map, S_ini, E_ini, I_asymp_ini, I_presymp_ini, I_symp_ini, H_ini, D_ini, P_ini ...</span></span>
<span><span class="co">#&gt; Population groups: 24 </span></span>
<span><span class="co">#&gt; Start date: 2023-09-30 </span></span>
<span><span class="co">#&gt; Population mapping: [ 24 rows x 4 columns]</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="exploring-configuration-parameters">Exploring Configuration Parameters<a class="anchor" aria-label="anchor" href="#exploring-configuration-parameters"></a>
</h4>
<p>The <code>MetaRVMConfig</code> class provides several methods to
explore the simulation arguments:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List all available parameters</span></span>
<span><span class="va">param_names</span> <span class="op">&lt;-</span> <span class="va">config_obj</span><span class="op">$</span><span class="fu">list_parameters</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">param_names</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "N_pop"         "pop_map"       "S_ini"         "E_ini"        </span></span>
<span><span class="co">#&gt;  [5] "I_asymp_ini"   "I_presymp_ini" "I_symp_ini"    "H_ini"        </span></span>
<span><span class="co">#&gt;  [9] "D_ini"         "P_ini"</span></span>
<span></span>
<span><span class="co"># Get a summary of parameter types and sizes</span></span>
<span><span class="va">param_summary</span> <span class="op">&lt;-</span> <span class="va">config_obj</span><span class="op">$</span><span class="fu">parameter_summary</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">param_summary</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;                   parameter       type length size</span></span>
<span><span class="co">#&gt; N_pop                 N_pop    integer      1    1</span></span>
<span><span class="co">#&gt; pop_map             pop_map data.table      4    4</span></span>
<span><span class="co">#&gt; S_ini                 S_ini    integer     24   24</span></span>
<span><span class="co">#&gt; E_ini                 E_ini    numeric     24   24</span></span>
<span><span class="co">#&gt; I_asymp_ini     I_asymp_ini    numeric     24   24</span></span>
<span><span class="co">#&gt; I_presymp_ini I_presymp_ini    numeric     24   24</span></span>
<span><span class="co">#&gt; I_symp_ini       I_symp_ini    integer     24   24</span></span>
<span><span class="co">#&gt; H_ini                 H_ini    numeric     24   24</span></span>
<span><span class="co">#&gt; D_ini                 D_ini    numeric     24   24</span></span>
<span><span class="co">#&gt; P_ini                 P_ini    integer     24   24</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="accessing-demographic-information">Accessing Demographic Information<a class="anchor" aria-label="anchor" href="#accessing-demographic-information"></a>
</h4>
<p>One of MetaRVM’s key features is demographic stratification, and it’s
ability to define parameters for specific demographic strata.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get demographic categories</span></span>
<span><span class="va">age_categories</span> <span class="op">&lt;-</span> <span class="va">config_obj</span><span class="op">$</span><span class="fu">get_age_categories</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">race_categories</span> <span class="op">&lt;-</span> <span class="va">config_obj</span><span class="op">$</span><span class="fu">get_race_categories</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">zones</span> <span class="op">&lt;-</span> <span class="va">config_obj</span><span class="op">$</span><span class="fu">get_zones</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Age categories:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">age_categories</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Age categories: 0-17, 18-64, 65+</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Race categories:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">race_categories</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Race categories: A, B, C, D</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Geographic zones:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">zones</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Geographic zones: 11, 22</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="alternative-ways-to-run-the-simulation">Alternative Ways to Run the Simulation<a class="anchor" aria-label="anchor" href="#alternative-ways-to-run-the-simulation"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Method 1: Direct from file path</span></span>
<span><span class="co"># sim_out &lt;- metaRVM(config_file)</span></span>
<span></span>
<span><span class="co"># Method 2: From MetaRVMConfig object</span></span>
<span><span class="va">sim_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metaRVM.html">metaRVM</a></span><span class="op">(</span><span class="va">config_obj</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating model in c</span></span>
<span><span class="co">#&gt; Using cached model</span></span>
<span></span>
<span><span class="co"># Method 3: From parsed configuration list</span></span>
<span><span class="va">config_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/parse_config.html">parse_config</a></span><span class="op">(</span><span class="va">yaml_file</span><span class="op">)</span></span>
<span><span class="va">sim_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metaRVM.html">metaRVM</a></span><span class="op">(</span><span class="va">config_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generating model in c</span></span>
<span><span class="co">#&gt; Using cached model</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="exploring-the-results">Exploring the Results<a class="anchor" aria-label="anchor" href="#exploring-the-results"></a>
</h3>
<p>The <code><a href="../reference/metaRVM.html">metaRVM()</a></code> function returns a
<code>MetaRVMResults</code> object with formatted, analysis-ready data.
The results are formatted with calendar dates and demographic
attributes, and stored in a data frame called results:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Look at the structure of formatted results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt;          date    age   race   zone disease_state        value instance</span></span>
<span><span class="co">#&gt;        &lt;Date&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;        &lt;char&gt;        &lt;num&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1: 2023-10-01   0-17      A     11             D 2.252583e-04        1</span></span>
<span><span class="co">#&gt; 2: 2023-10-01   0-17      A     11             E 1.305178e+01        1</span></span>
<span><span class="co">#&gt; 3: 2023-10-01   0-17      A     11             H 2.304447e-01        1</span></span>
<span><span class="co">#&gt; 4: 2023-10-01   0-17      A     11         I_all 2.731688e+01        1</span></span>
<span><span class="co">#&gt; 5: 2023-10-01   0-17      A     11       I_asymp 3.227854e-01        1</span></span>
<span><span class="co">#&gt; 6: 2023-10-01   0-17      A     11         I_eff 2.647304e+01        1</span></span>
<span></span>
<span><span class="co"># Check unique values for key variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Disease states:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">disease_state</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Disease states: D, E, H, I_all, I_asymp, I_eff, I_presymp, I_symp, P, R, S, V, cum_V, mob_pop, n_EI, n_EIpresymp, n_HD, n_HR, n_HRD, n_IasympR, n_IsympH, n_IsympR, n_IsympRH, n_SE, n_SV, n_VE, n_VS, n_preIsymp, p_HRD, p_SE, p_VE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Date range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">sim_out</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" to "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Date range: 2023-10-01 to 2024-02-27</span></span></code></pre></div>
<div class="section level4">
<h4 id="data-subsetting-and-filtering">Data Subsetting and Filtering<a class="anchor" aria-label="anchor" href="#data-subsetting-and-filtering"></a>
</h4>
<p>The <code>subset_data()</code> method provides flexible filtering
across all demographic and temporal dimensions. It returns an object of
class <code>MetaRVMResults</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset by single criteria</span></span>
<span><span class="va">hospitalized_data</span> <span class="op">&lt;-</span> <span class="va">sim_out</span><span class="op">$</span><span class="fu">subset_data</span><span class="op">(</span>disease_states <span class="op">=</span> <span class="st">"H"</span><span class="op">)</span></span>
<span><span class="va">hospitalized_data</span><span class="op">$</span><span class="va">results</span></span>
<span><span class="co">#&gt;             date    age   race   zone disease_state      value instance</span></span>
<span><span class="co">#&gt;           &lt;Date&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;        &lt;char&gt;      &lt;num&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt;    1: 2023-10-01   0-17      A     11             H  0.2304447        1</span></span>
<span><span class="co">#&gt;    2: 2023-10-01   0-17      B     11             H  0.5203590        1</span></span>
<span><span class="co">#&gt;    3: 2023-10-01   0-17      C     11             H  0.6244308        1</span></span>
<span><span class="co">#&gt;    4: 2023-10-01   0-17      D     11             H  1.4867401        1</span></span>
<span><span class="co">#&gt;    5: 2023-10-01  18-64      A     11             H  0.3047817        1</span></span>
<span><span class="co">#&gt;   ---                                                                  </span></span>
<span><span class="co">#&gt; 3596: 2024-02-27  18-64      D     22             H  3.0395514        1</span></span>
<span><span class="co">#&gt; 3597: 2024-02-27    65+      A     22             H  1.1267728        1</span></span>
<span><span class="co">#&gt; 3598: 2024-02-27    65+      B     22             H  1.8170253        1</span></span>
<span><span class="co">#&gt; 3599: 2024-02-27    65+      C     22             H 10.5249478        1</span></span>
<span><span class="co">#&gt; 3600: 2024-02-27    65+      D     22             H 11.8155938        1</span></span>
<span></span>
<span><span class="co"># Subset by multiple demographic categories</span></span>
<span><span class="va">elderly_data</span> <span class="op">&lt;-</span> <span class="va">sim_out</span><span class="op">$</span><span class="fu">subset_data</span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"65+"</span><span class="op">)</span>,</span>
<span>  disease_states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"H"</span>, <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">elderly_data</span><span class="op">$</span><span class="va">results</span></span>
<span><span class="co">#&gt;             date    age   race   zone disease_state        value instance</span></span>
<span><span class="co">#&gt;           &lt;Date&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;        &lt;char&gt;        &lt;num&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt;    1: 2023-10-01    65+      A     11             D 2.179919e-05        1</span></span>
<span><span class="co">#&gt;    2: 2023-10-01    65+      A     11             H 2.230110e-02        1</span></span>
<span><span class="co">#&gt;    3: 2023-10-01    65+      B     11             D 8.719675e-05        1</span></span>
<span><span class="co">#&gt;    4: 2023-10-01    65+      B     11             H 8.920441e-02        1</span></span>
<span><span class="co">#&gt;    5: 2023-10-01    65+      C     11             D 8.719675e-05        1</span></span>
<span><span class="co">#&gt;   ---                                                                    </span></span>
<span><span class="co">#&gt; 2396: 2024-02-27    65+      B     22             H 1.817025e+00        1</span></span>
<span><span class="co">#&gt; 2397: 2024-02-27    65+      C     22             D 7.200535e+01        1</span></span>
<span><span class="co">#&gt; 2398: 2024-02-27    65+      C     22             H 1.052495e+01        1</span></span>
<span><span class="co">#&gt; 2399: 2024-02-27    65+      D     22             D 8.575556e+01        1</span></span>
<span><span class="co">#&gt; 2400: 2024-02-27    65+      D     22             H 1.181559e+01        1</span></span>
<span></span>
<span><span class="co"># Specific date range</span></span>
<span><span class="va">peak_period</span> <span class="op">&lt;-</span> <span class="va">sim_out</span><span class="op">$</span><span class="fu">subset_data</span><span class="op">(</span></span>
<span>  date_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-10-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-12-31"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  disease_states <span class="op">=</span> <span class="st">"H"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; 19631 </span></span>
<span><span class="co">#&gt; 19722</span></span>
<span><span class="va">peak_period</span><span class="op">$</span><span class="va">results</span></span>
<span><span class="co">#&gt;             date    age   race   zone disease_state      value instance</span></span>
<span><span class="co">#&gt;           &lt;Date&gt; &lt;char&gt; &lt;char&gt; &lt;char&gt;        &lt;char&gt;      &lt;num&gt;    &lt;int&gt;</span></span>
<span><span class="co">#&gt;    1: 2023-10-01   0-17      A     11             H  0.2304447        1</span></span>
<span><span class="co">#&gt;    2: 2023-10-01   0-17      B     11             H  0.5203590        1</span></span>
<span><span class="co">#&gt;    3: 2023-10-01   0-17      C     11             H  0.6244308        1</span></span>
<span><span class="co">#&gt;    4: 2023-10-01   0-17      D     11             H  1.4867401        1</span></span>
<span><span class="co">#&gt;    5: 2023-10-01  18-64      A     11             H  0.3047817        1</span></span>
<span><span class="co">#&gt;   ---                                                                  </span></span>
<span><span class="co">#&gt; 2204: 2023-12-31  18-64      D     22             H 10.4962344        1</span></span>
<span><span class="co">#&gt; 2205: 2023-12-31    65+      A     22             H  1.4359176        1</span></span>
<span><span class="co">#&gt; 2206: 2023-12-31    65+      B     22             H  4.5128832        1</span></span>
<span><span class="co">#&gt; 2207: 2023-12-31    65+      C     22             H 55.2581815        1</span></span>
<span><span class="co">#&gt; 2208: 2023-12-31    65+      D     22             H 74.6513628        1</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="specifying-disease-parameter-via-distributions">Specifying Disease Parameter via Distributions<a class="anchor" aria-label="anchor" href="#specifying-disease-parameter-via-distributions"></a>
</h2>
<p><code>metaRVM</code> allows for disease parameters to be specified as
distributions, which is useful for capturing uncertainty. When a
parameter is defined by a distribution, each simulation instance will
draw a new value from that distribution. For more details on the
available distributions and their parameters, refer to the
<code>yaml-configuration</code> vignette.</p>
<p>An example YAML file with parameter distributions is included in the
package, <code>example_config_dist.yaml</code>. Here is its content:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Locate the example YAML configuration file with distributions</span></span>
<span><span class="va">yaml_file_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_config_dist.yaml"</span>, package <span class="op">=</span> <span class="st">"MetaRVM"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">run_id</span><span class="kw">:</span><span class="at"> ExampleRun_Dist</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">population_data</span><span class="kw">:</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="at">  </span><span class="fu">mapping</span><span class="kw">:</span><span class="at"> demographic_mapping_n24.csv</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="at">  </span><span class="fu">initialization</span><span class="kw">:</span><span class="at"> population_init_n24.csv</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="at">  </span><span class="fu">vaccination</span><span class="kw">:</span><span class="at"> vaccination_n24.csv</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="fu">mixing_matrix</span><span class="kw">:</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="at">  </span><span class="fu">weekday_day</span><span class="kw">:</span><span class="at"> m_weekday_day.csv</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="at">  </span><span class="fu">weekday_night</span><span class="kw">:</span><span class="at"> m_weekday_night.csv</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="at">  </span><span class="fu">weekend_day</span><span class="kw">:</span><span class="at"> m_weekend_day.csv</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="at">  </span><span class="fu">weekend_night</span><span class="kw">:</span><span class="at"> m_weekend_night.csv</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="fu">disease_params</span><span class="kw">:</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="at">  </span><span class="fu">ts</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="at">  </span><span class="fu">tv</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.25</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="at">  </span><span class="fu">ve</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="at">    </span><span class="fu">dist</span><span class="kw">:</span><span class="at"> uniform</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="at">    </span><span class="fu">min</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="at">    </span><span class="fu">max</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="at">  </span><span class="fu">dv</span><span class="kw">:</span><span class="at"> </span><span class="dv">180</span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="at">  </span><span class="fu">dp</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="at">  </span><span class="fu">de</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="at">  </span><span class="fu">da</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="at">    </span><span class="fu">dist</span><span class="kw">:</span><span class="at"> uniform</span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="at">    </span><span class="fu">min</span><span class="kw">:</span><span class="at"> </span><span class="dv">4</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="at">    </span><span class="fu">max</span><span class="kw">:</span><span class="at"> </span><span class="dv">6</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="at">  </span><span class="fu">ds</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a><span class="at">    </span><span class="fu">dist</span><span class="kw">:</span><span class="at"> uniform</span></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="at">    </span><span class="fu">min</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a><span class="at">    </span><span class="fu">max</span><span class="kw">:</span><span class="at"> </span><span class="dv">7</span></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="at">  </span><span class="fu">dh</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a><span class="at">    </span><span class="fu">dist</span><span class="kw">:</span><span class="at"> lognormal</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a><span class="at">    </span><span class="fu">mu</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a><span class="at">    </span><span class="fu">sd</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a><span class="at">  </span><span class="fu">dr</span><span class="kw">:</span><span class="at"> </span><span class="dv">180</span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a><span class="at">  </span><span class="fu">pea</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a><span class="at">  </span><span class="fu">psr</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.95</span></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a><span class="at">  </span><span class="fu">phr</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.97</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a><span class="fu">simulation_config</span><span class="kw">:</span></span>
<span id="cb11-38"><a href="#cb11-38" tabindex="-1"></a><span class="at">  </span><span class="fu">start_date</span><span class="kw">:</span><span class="at"> 01/01/2023</span><span class="co"> # m/d/Y</span></span>
<span id="cb11-39"><a href="#cb11-39" tabindex="-1"></a><span class="at">  </span><span class="fu">length</span><span class="kw">:</span><span class="at"> </span><span class="dv">150</span></span>
<span id="cb11-40"><a href="#cb11-40" tabindex="-1"></a><span class="at">  </span><span class="fu">nsim</span><span class="kw">:</span><span class="at"> </span><span class="dv">20</span><span class="co"> # Increased nsim for meaningful summary statistics</span></span></code></pre></div>
<p>To run a simulation with this configuration, we pass the file path to
<code>metaRVM</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the simulation with the new configuration</span></span>
<span><span class="va">sim_out_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metaRVM.html">metaRVM</a></span><span class="op">(</span><span class="va">yaml_file_dist</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="generating-summary-statistics-across-demographics">Generating Summary Statistics across Demographics<a class="anchor" aria-label="anchor" href="#generating-summary-statistics-across-demographics"></a>
</h3>
<p>The <code>MetaRVMResults</code> class provides basic summarization
functionality across multiple instances of the simulation, when one or
more disease parameters are specified via distribution, and there are
more than one simulations per configurations. The <code>summarize</code>
method generates output of class <code>MetaRVMSummary</code> which has a
<code>plot</code> method available to use. Now that we have run a
simulation with parameter distributions, we can use the
<code>summarize</code> method to see the variability in the results.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarize hospitalizations by age group</span></span>
<span><span class="va">hospital_summary_dist</span> <span class="op">&lt;-</span> <span class="va">sim_out_dist</span><span class="op">$</span><span class="fu">summarize</span><span class="op">(</span></span>
<span>  group_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span>,</span>
<span>  disease_states <span class="op">=</span> <span class="st">"n_IsympH"</span>,</span>
<span>  stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span>, <span class="st">"quantile"</span><span class="op">)</span>,</span>
<span>  quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the summary</span></span>
<span><span class="va">hospital_summary_dist</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Daily Hospitalizations by Age Group (with 90% confidence interval)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="running-a-simulation_files/figure-html/unnamed-chunk-12-1.png" width="768" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Summary of hospitalizations by age and race group</span></span>
<span><span class="va">hospital_summary</span> <span class="op">&lt;-</span> <span class="va">sim_out_dist</span><span class="op">$</span><span class="fu">summarize</span><span class="op">(</span></span>
<span>  group_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"race"</span><span class="op">)</span>,</span>
<span>  disease_states <span class="op">=</span> <span class="st">"n_IsympH"</span>,</span>
<span>  stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span>, <span class="st">"quantile"</span><span class="op">)</span>,</span>
<span>  quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">hospital_summary</span></span>
<span><span class="co">#&gt; MetaRVM Summary Object</span></span>
<span><span class="co">#&gt; ======================</span></span>
<span><span class="co">#&gt; Data type: summary </span></span>
<span><span class="co">#&gt; Observations: 1800 </span></span>
<span><span class="co">#&gt; Grouped by: age, race </span></span>
<span><span class="co">#&gt; Disease states: n_IsympH </span></span>
<span><span class="co">#&gt; Date range: 2023-01-01 to 2023-05-30 </span></span>
<span><span class="co">#&gt; Summary statistics: median_value, q05, q95</span></span>
<span></span>
<span><span class="co"># visualize the summary</span></span>
<span><span class="va">hospital_summary</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Daily Hospitalizations by Age and Race"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="running-a-simulation_files/figure-html/unnamed-chunk-13-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="specifying-disease-parameters-by-demographics">Specifying Disease Parameters by Demographics<a class="anchor" aria-label="anchor" href="#specifying-disease-parameters-by-demographics"></a>
</h2>
<p>The disease parameters can also be specified for different
demographic subgroups. These subgroup-specific parameters will override
the global parameters. For more details, refer to the
<code>yaml-configuration</code> vignette. An example YAML file is
provided, <code>example_config_subgroup_dist.yaml</code>, that
demonstrates this feature. It also includes parameters defined by
distributions.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Locate the example YAML configuration file with subgroup parameters</span></span>
<span><span class="va">yaml_file_subgroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_config_subgroup_dist.yaml"</span>, package <span class="op">=</span> <span class="st">"MetaRVM"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">run_id</span><span class="kw">:</span><span class="at"> ExampleRun_Subgroup_Dist</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="fu">population_data</span><span class="kw">:</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a><span class="at">  </span><span class="fu">mapping</span><span class="kw">:</span><span class="at"> demographic_mapping_n24.csv</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="at">  </span><span class="fu">initialization</span><span class="kw">:</span><span class="at"> population_init_n24.csv</span></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="at">  </span><span class="fu">vaccination</span><span class="kw">:</span><span class="at"> vaccination_n24.csv</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="fu">mixing_matrix</span><span class="kw">:</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="at">  </span><span class="fu">weekday_day</span><span class="kw">:</span><span class="at"> m_weekday_day.csv</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="at">  </span><span class="fu">weekday_night</span><span class="kw">:</span><span class="at"> m_weekday_night.csv</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="at">  </span><span class="fu">weekend_day</span><span class="kw">:</span><span class="at"> m_weekend_day.csv</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="at">  </span><span class="fu">weekend_night</span><span class="kw">:</span><span class="at"> m_weekend_night.csv</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="fu">disease_params</span><span class="kw">:</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="at">  </span><span class="fu">ts</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="at">  </span><span class="fu">tv</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.25</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="at">  </span><span class="fu">ve</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="at">    </span><span class="fu">dist</span><span class="kw">:</span><span class="at"> uniform</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a><span class="at">    </span><span class="fu">min</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a><span class="at">    </span><span class="fu">max</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span></span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a><span class="at">  </span><span class="fu">dv</span><span class="kw">:</span><span class="at"> </span><span class="dv">180</span></span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a><span class="at">  </span><span class="fu">dp</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a><span class="at">  </span><span class="fu">de</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a><span class="at">  </span><span class="fu">da</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a><span class="at">  </span><span class="fu">ds</span><span class="kw">:</span><span class="at"> </span><span class="dv">6</span></span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a><span class="at">  </span><span class="fu">dh</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a><span class="at">    </span><span class="fu">dist</span><span class="kw">:</span><span class="at"> lognormal</span></span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a><span class="at">    </span><span class="fu">mu</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="at">    </span><span class="fu">sd</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.5</span></span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a><span class="at">  </span><span class="fu">dr</span><span class="kw">:</span><span class="at"> </span><span class="dv">180</span></span>
<span id="cb16-28"><a href="#cb16-28" tabindex="-1"></a><span class="at">  </span><span class="fu">pea</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.3</span></span>
<span id="cb16-29"><a href="#cb16-29" tabindex="-1"></a><span class="at">  </span><span class="fu">psr</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.95</span></span>
<span id="cb16-30"><a href="#cb16-30" tabindex="-1"></a><span class="at">  </span><span class="fu">phr</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.97</span></span>
<span id="cb16-31"><a href="#cb16-31" tabindex="-1"></a><span class="fu">sub_disease_params</span><span class="kw">:</span></span>
<span id="cb16-32"><a href="#cb16-32" tabindex="-1"></a><span class="at">    </span><span class="fu">age</span><span class="kw">:</span></span>
<span id="cb16-33"><a href="#cb16-33" tabindex="-1"></a><span class="at">      </span><span class="fu">0-17</span><span class="kw">:</span></span>
<span id="cb16-34"><a href="#cb16-34" tabindex="-1"></a><span class="at">        </span><span class="fu">pea</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.08</span></span>
<span id="cb16-35"><a href="#cb16-35" tabindex="-1"></a><span class="at">      </span><span class="fu">18-64</span><span class="kw">:</span></span>
<span id="cb16-36"><a href="#cb16-36" tabindex="-1"></a><span class="at">        </span><span class="fu">ts</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.6</span></span>
<span id="cb16-37"><a href="#cb16-37" tabindex="-1"></a><span class="at">      </span><span class="fu">65+</span><span class="kw">:</span></span>
<span id="cb16-38"><a href="#cb16-38" tabindex="-1"></a><span class="co">        # This fixed value will override the global lognormal distribution for dh</span></span>
<span id="cb16-39"><a href="#cb16-39" tabindex="-1"></a><span class="at">        </span><span class="fu">dh</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span><span class="at"> </span></span>
<span id="cb16-40"><a href="#cb16-40" tabindex="-1"></a><span class="at">        </span><span class="fu">phr</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.9227</span></span>
<span id="cb16-41"><a href="#cb16-41" tabindex="-1"></a><span class="fu">simulation_config</span><span class="kw">:</span></span>
<span id="cb16-42"><a href="#cb16-42" tabindex="-1"></a><span class="at">  </span><span class="fu">start_date</span><span class="kw">:</span><span class="at"> 01/01/2023</span><span class="co"> # m/d/Y</span></span>
<span id="cb16-43"><a href="#cb16-43" tabindex="-1"></a><span class="at">  </span><span class="fu">length</span><span class="kw">:</span><span class="at"> </span><span class="dv">150</span></span>
<span id="cb16-44"><a href="#cb16-44" tabindex="-1"></a><span class="at">  </span><span class="fu">nsim</span><span class="kw">:</span><span class="at"> </span><span class="dv">20</span></span></code></pre></div>
<p>Now, let’s run the simulation with this configuration.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run the simulation with the subgroup configuration</span></span>
<span><span class="va">sim_out_subgroup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metaRVM.html">metaRVM</a></span><span class="op">(</span><span class="va">yaml_file_subgroup</span><span class="op">)</span></span></code></pre></div>
<p>We can now plot the results to see the impact of the
subgroup-specific parameters. For example, we can compare the number of
hospitalizations in the “65+” age group, which has a <code>dh</code> of
10, to other age groups that use the global <code>dh</code> drawn from a
lognormal distribution.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Summarize hospitalizations by age group</span></span>
<span><span class="va">hospital_summary_subgroup</span> <span class="op">&lt;-</span> <span class="va">sim_out_subgroup</span><span class="op">$</span><span class="fu">summarize</span><span class="op">(</span></span>
<span>  group_by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span><span class="op">)</span>,</span>
<span>  disease_states <span class="op">=</span> <span class="st">"H"</span>,</span>
<span>  stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"median"</span>, <span class="st">"quantile"</span><span class="op">)</span>,</span>
<span>  quantiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the summary</span></span>
<span><span class="va">hospital_summary_subgroup</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Daily Hospitalizations by Age Group (Subgroup Parameters)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="running-a-simulation_files/figure-html/unnamed-chunk-16-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Arindam Fadikar, Charles Macal.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
